!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e="required",t="length",n="type",r="range",o={REQUIRED:"$field$,输入值不可为空",LENGTH:"$field$,输入超长，最大长度为$rule$",TYPE:"$field$,输入的类型不正确，应为$rule$类型",RANGE:"$field$,输入不在范围内，应在$range1$~$range2$之内",LACK:"上送字段缺失，缺少字段$field$"},i="WEBFUNNY_COOKIE";var a,s,c,u=(a=function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},a(s={exports:{}},s.exports),s.exports);function f(e,t,n){if(window){var r=localStorage,o={data:t,expires:n};if(r.WEBFUNNY_COOKIE){var a=JSON.parse(r.WEBFUNNY_COOKIE);a[e]=o,r.WEBFUNNY_COOKIE=JSON.stringify(a)}else{var s={};s[e]=o,r.WEBFUNNY_COOKIE=JSON.stringify(s)}}else{var c={data:t,expires:n},u=uni.getStorageSync(i);if(console.log("=================================1",u),console.log(u),u)u[e]=c,uni.setStorageSync(i,u);else{var f={};f[e]=c,uni.setStorageSync(i,f)}}}function l(e){if(window){var t=localStorage,n=null;if(t.WEBFUNNY_COOKIE){var r=(n=JSON.parse(t.WEBFUNNY_COOKIE))[e];if(!r)return"";var o=parseInt(r.expires,10);return(new Date).getTime()>o?(delete n[e],t.WEBFUNNY_COOKIE=JSON.stringify(n),""):r.data}return""}var a=uni.getStorageSync(i);if(a){var s=a[e];if(!s)return"";var c=parseInt(s.expires,10);return(new Date).getTime()>c?(delete a[e],uni.setStorageSync(i,a),""):s.data}return""}function p(){var e=(new Date).Format("yyyyMMddhhmmssS");return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))+"-"+e}function g(){var e=p(),t=l("monitorCustomerKey");t||(f("monitorCustomerKey",e,(new Date).getTime()+31104e7),t=e);return t}(c=u)&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")&&c.default,Date.prototype.Format||(Date.prototype.Format=function(e){var t=e,n={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t});var d={isString:function(e){return"[object String]"===Object.prototype.toString.apply(e)},isNumber:function(e){return"[object Number]"===Object.prototype.toString.apply(e)},isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},isObject:function(e){return"[object Object]"===Object.prototype.toString.apply(e)},isDate:function(e){return"[object Date]"===Object.prototype.toString.apply(e)},isBoolean:function(e){return"[object Boolean]"===Object.prototype.toString.apply(e)},getUuid:p,getWfCookie:l,setWfCookie:f,combineObject:function(e,t){return Object.assign(e,t)},getCustomerKey:g,getWeUserInfo:function(e){if(window){var t=localStorage;if(!e)return"";var n=(t.weUserInfo?JSON.parse(t.weUserInfo):{})[e];return n||""}if(!e)return"";var r=uni.getStorageSync("weUserInfo"),o=(r?JSON.parse(r):{})[e];return o||""},setFirstActionTime:function(e){for(var t=l("weFunnelConfig").funnelList,n=void 0===t?[]:t,r=0;r<n.length;r++){var o=n[r],i=o.s,a=o.c,s=o.t,c=void 0===s?1:s,u=(new Date).getTime()+24*c*3600*1e3;if(-1!==i.indexOf(1*e)){var p=(new Date).Format("yyyyMMdd");f("".concat(a,"-FirstStepDay"),"".concat(a,"-").concat(p),u)}}},getFirstActionTime:function(e){for(var t=l("weFunnelConfig").funnelList,n=void 0===t?[]:t,r="",o=0;o<n.length;o++){var i=n[o],a=i.s,s=i.c;-1!==a.indexOf(1*e)&&(r+=l("".concat(s,"-FirstStepDay"))+",")}return r}};function y(e,t){var n=!1,r=function(e,t){var n={success:!1,field:""};for(var r in t){if(!Object.prototype.hasOwnProperty.call(e,r))return n.success=!1,n.field=r,n;n.success=!0}return n}(e,t),i=r.success,a=r.field;if(!(n=i)){var s=o.LACK.replace(/\$field\$/g,a);return console.warn(s),n}for(var c in t){if(!(n=v(e[c],c,t[c])))return n}return n}function v(i,a,s){var c=!1;for(var u in s){var f=s[u];if(u===e&&f){if(!(c=void 0!==i)){var l=o.REQUIRED.replace(/\$field\$/g,a).replace(/\$rule\$/g,"");return console.warn(l),c}}else if(u===t&&f){if(!(c=i.toString().length<=f)){var p=o.LENGTH.replace(/\$field\$/g,a).replace(/\$rule\$/g,f);return console.warn(p),c}}else if(u===n&&f){if(!(c=(0,d["is"+f])(i))){var g=o.TYPE.replace(/\$field\$/g,a).replace(/\$rule\$/g,f);return console.warn(g),c}}else if(u===r&&f){var y=i>=f[0]&&i<f[1];if(!y){var v=o.RANGE.replace(/\$field\$/g,a).replace(/\$range1\$/g,f[0]).replace(/\$range2\$/g,f[1]);return console.warn(v),y}}}return c}var x="http://localhost:8015",w={trackUrl:"".concat(x,"/tracker/upEvent"),eventDomain:x,requestMethod:"POST"};function $(){var e=w.trackUrl;if(window){var t=window.location.protocol;return t=t.replace(/file/g,"http"),e.indexOf("http")>-1?e:t+e}return e}function S(){var e=w.eventDomain;if(window){var t=window.location.protocol;return t=t.replace(/file/g,"http"),e.indexOf("http")>-1?e:t+e}return e}function O(e,t,n){var r=$();try{var o=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");o.open("POST",r,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.onreadystatechange=function(){if(4==o.readyState){var e={};try{e=o.responseText?JSON.parse(o.responseText):{}}catch(t){e={}}"function"==typeof t&&t(e)}},o.onerror=function(){"function"==typeof n&&n()},o.send("data="+JSON.stringify(e))}catch(t){!function(e){var t=$(),n=t+(t.indexOf("?")<0?"?":"&")+e;new Image(1,1).src=n}(e)}}function m(e){if(window&&e)O(e,(function(e){d.setWfCookie("weFunnelConfig",{funnelList:e.data},(new Date).getTime()+864e5)}),(function(e){console.log(e)}));else if(e){var t=w.trackUrl;uni.request({url:t,data:e,method:"POST",header:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},success:function(e){var t=JSON.parse(e.data);d.setWfCookie("weFunnelConfig",{funnelList:t.data},(new Date).getTime()+864e5)}})}}var h=function(){return{weCustomerKey:g(),weUserId:""}};!function(e){try{d.getWfCookie("weFunnelConfig")||e.request({url:S()+"/tracker/initCf",data:{projectId:"$$$projectId$$$"},dataType:"JSON",method:"POST",success:function(e){var t=JSON.parse(e.data);d.setWfCookie("weFunnelConfig",{funnelList:t.data},(new Date).getTime()+864e5)}}),d&&(e.webfunnyEventUtils=d,e.webfunnyEventGetCustomerInfo=h,e.webfunnyEventUtils.getCustomerKey()),y&&m&&(e.webfunnyEventValidateParams=y,e.webfunnyEventSendRequest=m,e._webfunnyEvent="$$$webfunny-event-code$$$")}catch(e){console.error(e)}}(uni)}));
